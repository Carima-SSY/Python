<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>JSON -> XML ë³€í™˜ ë° ìœ ì—°í•œ í‘œ í‘œì‹œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
        }
        #controls {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
        }
        h2 { color: #333; }
        
        /* í‘œ ìŠ¤íƒ€ì¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
        }
        th, td {
            border: 1px solid #dddddd;
            padding: 10px;
            text-align: left;
        }
        /* RecipeManager (ë‹¤ì—´) í‘œ ìŠ¤íƒ€ì¼ */
        .data-table th {
            background-color: #4CAF50; 
            color: white;
        }
        /* SensorData (2ì—´) í‘œ ìŠ¤íƒ€ì¼ */
        .keyval-table th {
            background-color: #2196F3;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        /* XML ì¶œë ¥ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #xml-output {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            background-color: #f0f0f5;
            white-space: pre-wrap;
            font-family: monospace;
            overflow-x: auto;
        }
    </style>
</head>
<body>

    <h1>JSON íŒŒì¼ ë³€í™˜ ë° ìœ ì—°í•œ ë¶„ì„</h1>
    
    <div id="controls">
        <h2>ğŸ“‚ JSON íŒŒì¼ ì„ íƒ</h2>
        <input type="file" id="json-input" accept=".json">
        <p style="font-size: 0.9em; color: #555;">(RecipeManager ë˜ëŠ” SensorData êµ¬ì¡°ì˜ JSON íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.)</p>
    </div>

    <div id="table-container">
        <h2>ğŸ“‹ ë°ì´í„° ë¶„ì„ ê²°ê³¼</h2>
        <p>íŒŒì¼ì„ ì„ íƒí•˜ë©´ ë°ì´í„° êµ¬ì¡°ì— ë§ëŠ” í‘œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
    </div>
    
    <h2>ğŸ“„ ë³€í™˜ëœ XML ì „ë¬¸</h2>
    <div id="xml-output">
        XML ê²°ê³¼ë¬¼ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
    </div>

    <script>
        document.getElementById('json-input').addEventListener('change', handleFileSelect);

        // ----------------------------------------------------------------------------------
        // 1. íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ ì²˜ë¦¬
        // ----------------------------------------------------------------------------------
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();

            reader.onload = function(e) {
                const jsonString = e.target.result;
                const container = document.getElementById('table-container');
                container.innerHTML = '<h2>ğŸ“‹ ë°ì´í„° ë¶„ì„ ê²°ê³¼</h2>';
                
                try {
                    const dataObject = JSON.parse(jsonString);
                    
                    // JSON -> XML ë³€í™˜ ë° ì¶œë ¥
                    const xmlString = convertJsonToXml(dataObject);
                    document.getElementById('xml-output').textContent = xmlString; 
                    
                    // í‘œ ìƒì„±ì„ ìœ„í•œ ë°ì´í„° ì¶”ì¶œ ë° í˜•ì‹ íŒë³„
                    analyzeAndCreateTable(dataObject);

                } catch (error) {
                    alert(`âŒ íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}\nì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.`);
                    console.error("íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:", error);
                    document.getElementById('xml-output').textContent = `ì˜¤ë¥˜: ${error.message}`;
                    container.innerHTML += '<p style="color:red;">ë°ì´í„° ë¡œë“œ ë° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.</p>';
                }
            };

            reader.readAsText(file);
        }
        
        /**
         * JSON ê°ì²´ë¥¼ ë¶„ì„í•˜ì—¬ ì–´ë–¤ í‘œë¥¼ ìƒì„±í• ì§€ ê²°ì •í•©ë‹ˆë‹¤.
         */
        function analyzeAndCreateTable(dataObject) {
            // 1. RecipeManager í˜•ì‹ í™•ì¸
            if (dataObject.RecipeManager && Array.isArray(dataObject.RecipeManager.Recipe)) {
                // Recipe ë°°ì—´ì´ ìˆëŠ” ê²½ìš° (ë‹¤ì—´ í‘œ ìƒì„±)
                createDataTable(dataObject.RecipeManager.Recipe, 'RecipeManager.Recipe');
                return;
            }

            // 2. SensorData í˜•ì‹ í™•ì¸
            if (dataObject.SensorData && dataObject.SensorData.Sensor && typeof dataObject.SensorData.Sensor === 'object') {
                // Sensor ê°ì²´ê°€ ìˆëŠ” ê²½ìš° (2ì—´ Key-Value í‘œ ìƒì„±)
                createKeyValTable(dataObject.SensorData.Sensor, 'SensorData.Sensor');
                return;
            }
            
            // 3. ê¸°íƒ€ ë‹¨ì¼ ë£¨íŠ¸ ê°ì²´ ì²˜ë¦¬
            const rootKey = Object.keys(dataObject)[0];
            if (rootKey && typeof dataObject[rootKey] === 'object' && !Array.isArray(dataObject[rootKey])) {
                // ìµœìƒìœ„ ê°ì²´ ì•„ë˜ì— ë˜ ë‹¤ë¥¸ ë‹¨ì¼ ê°ì²´ê°€ ìˆì„ ê²½ìš° (SensorDataì™€ ìœ ì‚¬)
                createKeyValTable(dataObject[rootKey], rootKey);
                return;
            }

            // 4. ì²˜ë¦¬ ë¶ˆê°€
            document.getElementById('table-container').innerHTML += '<p>ë°ì´í„° êµ¬ì¡°ê°€ ì˜ˆìƒí–ˆë˜ RecipeManager ë˜ëŠ” SensorData í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.</p>';
        }

        // ----------------------------------------------------------------------------------
        // 2. JSON ê°ì²´ë¥¼ XML ë¬¸ìì—´ë¡œ ë³€í™˜ (ì¬ê·€ í•¨ìˆ˜)
        // ----------------------------------------------------------------------------------

        function convertJsonToXml(jsonObj) {
            let xml = '';
            xml += '<?xml version="1.0" standalone="yes"?>\n'; 
            
            const rootKey = Object.keys(jsonObj)[0];
            xml += convertObjectToXml(jsonObj, '');
            
            // XML ì„ ì–¸ì„ ì œì™¸í•˜ê³  ìµœìƒìœ„ íƒœê·¸ë§Œ ë°˜í™˜ë˜ë„ë¡ ì¡°ì •
            return xml.trim();
        }

        function convertObjectToXml(obj, indent) {
            let xml = '';

            for (const key in obj) {
                if (Object.prototype.hasOwnProperty.call(obj, key)) {
                    const value = obj[key];
                    
                    if (Array.isArray(value)) {
                        // ê°’ì´ ë°°ì—´ì¸ ê²½ìš° (Recipe ë°°ì—´)
                        value.forEach(item => {
                            // ë°°ì—´ ìš”ì†ŒëŠ” ë¶€ëª¨ í‚¤(Recipe)ì˜ íƒœê·¸ë¥¼ ì‚¬ìš©
                            xml += `${indent}<${key}>\n`;
                            xml += convertObjectToXml(item, indent + '  '); 
                            xml += `${indent}</${key}>\n`;
                        });
                        
                    } else if (typeof value === 'object' && value !== null) {
                        // ê°’ì´ ê°ì²´ì¸ ê²½ìš° (RecipeManager, Sensor, SensorData)
                        xml += `${indent}<${key}>\n`;
                        xml += convertObjectToXml(value, indent + '  '); // ì¬ê·€ í˜¸ì¶œ
                        xml += `${indent}</${key}>\n`;
                        
                    } else {
                        // ê°’ì´ ë‹¨ìˆœ ë¬¸ìì—´/ìˆ«ìì¸ ê²½ìš°
                        xml += `${indent}<${key}>${value}</${key}>\n`;
                    }
                }
            }
            return xml;
        }

        // ----------------------------------------------------------------------------------
        // 3. í‘œ ìƒì„± í•¨ìˆ˜
        // ----------------------------------------------------------------------------------
        
        /**
         * 3-1. ë°°ì—´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ì—´ í‘œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (RecipeManager í˜•ì‹)
         */
        function createDataTable(data, title) {
            const container = document.getElementById('table-container');

            // 1. ëª¨ë“  ê°ì²´ì˜ í‚¤ë¥¼ ëª¨ì•„ í—¤ë”ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
            let headers = new Set();
            data.forEach(item => {
                Object.keys(item).forEach(key => headers.add(key));
            });
            headers = Array.from(headers);

            let html = `<h2>ğŸ“‹ ë°ì´í„° ë¶„ì„ ê²°ê³¼ (${title})</h2>`;
            html += '<table class="data-table"><thead><tr>';

            // 2. í‘œ í—¤ë”(<th>) ìƒì„±
            headers.forEach(header => {
                html += `<th>${header}</th>`;
            });
            html += '</tr></thead><tbody>';

            // 3. í‘œ í–‰(<tr>)ê³¼ ì…€(<td>) ìƒì„±
            data.forEach(item => {
                html += '<tr>';
                headers.forEach(header => {
                    const cellValue = item[header] !== undefined ? item[header] : '-';
                    html += `<td>${cellValue}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        /**
         * 3-2. Key-Value ìŒìœ¼ë¡œ ì´ë£¨ì–´ì§„ ê°ì²´ë¥¼ 2ì—´ í‘œë¡œ ìƒì„±í•©ë‹ˆë‹¤. (SensorData í˜•ì‹)
         */
        function createKeyValTable(data, title) {
            const container = document.getElementById('table-container');
            let html = `<h2>ğŸ“‹ ì„¤ì • í•­ëª© í‘œ (${title})</h2>`;
            html += '<table class="keyval-table"><thead><tr>';
            html += '<th>ì„¤ì • í•­ëª© (Key)</th><th>ê°’ (Value)</th>';
            html += '</tr></thead><tbody>';

            for (const key in data) {
                if (Object.prototype.hasOwnProperty.call(data, key)) {
                    const value = data[key];
                    html += '<tr>';
                    html += `<td>${key}</td>`;
                    html += `<td>${value}</td>`;
                    html += '</tr>';
                }
            }
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
    </script>
</body>
</html>